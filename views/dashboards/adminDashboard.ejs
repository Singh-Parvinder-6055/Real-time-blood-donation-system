<% layout("layouts/boilerplate") %>

<div class="dashboard-container container my-5">

  <!-- Header -->
  <div class="mb-4">
    <h2 class="fw-bold text-danger">Admin Dashboard</h2>
    <p class="text-muted fst-italic">
      Track and manage camps, emergencies, and organization verifications
    </p>
    <h5 class="mt-3">Hey <%= currUser.username %> ðŸ‘‹</h5>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs shadow-sm" id="adminTab" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#camps">
        <i class="fa-solid fa-calendar-days me-1"></i> My Camps
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#emergencies">
        <i class="fa-solid fa-truck-medical me-1"></i> Emergencies
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#verified">
        <i class="fa-solid fa-circle-check me-1"></i> Verified Orgs
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#rejected">
        <i class="fa-solid fa-circle-xmark me-1"></i> Rejected Orgs
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content border border-top-0 p-4 bg-white shadow-sm">

    <!-- Camps -->
    <div class="tab-pane fade show active" id="camps">
      <h4 class="mb-3">Camps Organized by Me</h4>

      <% if (user.camps.length) { %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Camp Name</th>
                <th>Date</th>
                <th>City</th>
              </tr>
            </thead>
            <tbody>
              <% user.camps.forEach(camp => { %>
                <tr>
                  <td><%= camp.title %></td>
                  <td><%= camp.startDateTime.toDateString() %></td>
                  <td><%= camp.city %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="empty-state">
          <i class="fa-solid fa-campground"></i>
          <p>You havenâ€™t organized any camps yet.</p>
        </div>
      <% } %>
    </div>

    <!-- Emergencies -->
    <div class="tab-pane fade" id="emergencies">
      <h4 class="mb-3">My Emergency Requests</h4>

      <% if (user.emergencies.length) { %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-warning">
              <tr>
                <th>Patient</th>
                <th>Blood Group</th>
                <th>Units</th>
                <th>Hospital</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% user.emergencies.forEach(req => { %>
                <tr>
                  <td><%= req.patient.username %></td>
                  <td><span class="badge bg-danger"><%= req.bloodGroup %></span></td>
                  <td><%= req.unitsRequired %></td>
                  <td><%= req.requestedBy.username %></td>
                  <td>
                    <% if (req.isFulfilled) { %>
                      <span class="badge bg-success">Fulfilled</span>
                    <% } else { %>
                      <span class="badge bg-warning text-dark">Open</span>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="empty-state">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <p>No emergency requests created by you.</p>
        </div>
      <% } %>
    </div>

    <!-- Verified Orgs -->
    <div class="tab-pane fade" id="verified">
      <h4 class="mb-3">Verified Organizations</h4>

      <% if (verifiedOrgs.length) { %>
        <table class="table table-hover">
          <thead class="table-success">
            <tr>
              <th>Name</th>
              <th>City</th>
              <th>Contact</th>
            </tr>
          </thead>
          <tbody>
            <% verifiedOrgs.forEach(org => { %>
              <tr>
                <td><%= org.organization.username %></td>
                <td><%= org.organization.city %></td>
                <td><%= org.organization.phone %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <div class="empty-state">
          <i class="fa-solid fa-circle-check"></i>
          <p>No organizations verified yet.</p>
        </div>
      <% } %>
    </div>

    <!-- Rejected -->
    <div class="tab-pane fade" id="rejected">
      <h4 class="mb-3">Rejected Organizations</h4>

      <% if (rejectedOrgs.length) { %>
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Name</th>
              <th>City</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody>
            <% rejectedOrgs.forEach(org => { %>
              <tr>
                <td><%= org.organization.username %></td>
                <td><%= org.organization.city %></td>
                <td class="text-danger small"><%= org.rejectionReason %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <div class="empty-state">
          <i class="fa-solid fa-circle-xmark"></i>
          <p>No rejected verification requests.</p>
        </div>
      <% } %>
    </div>

  </div>
</div>
